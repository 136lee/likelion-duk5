{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="{% static 'css/account/explore.css'%}">
  <link rel="stylesheet" href="{% static 'css/account/feed.css'%}">
  <style>
    #chat .bot { white-space: pre-line; line-height: 1.6; margin: 8px 0 16px; }
  </style>
  <title>AI Chat (í…ìŠ¤íŠ¸+ì´ë¯¸ì§€)</title>
</head>

<body> 
  <header>
    <div id="head_feed">
        <a class="move_to_home" href="{% url 'map:list' %}">
          <img class="header_DBTB" src="{% static 'img/DBTB.png' %}">
        </a>
    </div>
     <div id="move">
        <a id="move_to_map" href="{% url 'map:list' %}">ì§€ë„</a >
        <a id="move_to_feed"  href="{% url 'feed:feed_all' %}">í”¼ë“œ</a>
        <a id="move_to_EX" href="{% url 'explore:chat_ai' %}">íƒí—˜</a>
    <a id="img_hole_header"  href="{% url 'account:mypage' %}">
    <!--  <img src="#" alt="ë‚´ í”„ë¡œí•„" width="24" height="24">-->
    {% if request.user.profile_image %}
    <img id="mypage_img" width="200px" src="{{ request.user.profile_image.url }}" alt="Profile Image">
{% else %}
    <img id="mypage_img" width="200px" src="{% static 'img/profile_image.jpg' %}" alt="Default Profile">
{% endif %}
  </a>
    </div>
</header>
<hr>
  

<main id="ex_main">
  <div id="leftBar">
    <div class="leftBarBox">
        <div class="line">
            <img src="{% static 'img/new_explore.png'%}" class="Bar_img">
            <div>ìƒˆ íƒí—˜</div>
        </div>
        <div class="line"> 
            <img src="{% static 'img/search_pest.png'%}" class="Bar_img">
            <div>ë‚´ì—­ ê²€ìƒ‰</div>
        </div>        
    </div>
    <div class="leftBarBox">
        <span>íƒí—˜</span>
        <div>ë„ë´‰êµ¬ ë§›ì§‘ ì°¾ê¸°</div>
        <div>ì˜¤ëŠ˜ì˜ ì¸ê¸° ê²Œì‹œë¬¼ ì°¾ê¸°</div>
    </div>
</div>
  
<div class="AI_main">
    <!--ì™¼ìª½ ë°”-->
   
    <div class="Question_box">
        <div class="Question">ë„ë´‰êµ¬ íƒí—˜ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
        <div class="total"  style="display: none;">
          <div class="conversation_place">
    <div id="chat" class="conversation">
      <!--<div class="commend_sort">
      <div class="commend">ë„ë´‰êµ¬ ë§›ì§‘ ì¶”ì²œí•´ì¤˜</div>
      </div>
    
    <div class="answer_sort"> 
      <div class="answer">ë„¤ ì•Œê² ìŠµë‹ˆë‹¤</div>
    </div>-->
    </div>
  </div> 
      </div>
    
        <div class="AI_search_bar">
          <input type="file" id="fileInput" accept="image/*">
          <label for="fileInput" class="custom-file-label">
            <img id="add" src="{% static 'img/addition.png'%}" alt="íŒŒì¼ ì„ íƒ">
          </label>   
          <input id="msg" class="AI_search_input" type="search" placeholder="ë¬´ì—‡ì´ë“  ê²€ìƒ‰í•˜ì„¸ìš”">
          <img class="send" id="sendBtn" src="{% static 'img/send.png'%}">
        </div>
    </div>

    </div>
</main>

<div class="AI_recommend">
  <article class="AI_recommend_box">
      <div id="article_title">ì˜¤ëŠ˜ì˜ ì¸ê¸° í¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!</div>
      <div class="article_content">
          <img id="article_img" src="{% static 'img/likelion.png'%}">
          <div class="article_content_detail">
              <div class="writer">
                  <div id="writerInfo">
                      <div id="wirter_circle"><img id="writer_img" src="{% static 'img/likelion.png'%}"></div>
                      <span id="userID">ë´‰ë´‰ë´‰</span>
                  </div>
                  <div class="AI_scrap">
                      <img src="{% static 'img/scrap_AI.png'%}">
                      <span>12</span>
                  </div>
              </div>
              <div id="review">ì—¬ë¦„ì•„ì¹¨ ë•ì„±ì—¬ëŒ€. ì”ë””ë°­ì— ì•‰ì•„ì„œ ì‚°ê³¼ í•˜ëŠ˜ì„ ë°”ë¼ë³´ë©´ ë§ˆìŒì´ íƒ íŠ¸ì—¬ìš”!</div>
              <div id="recommend_post"><div id="button_recommend">ì¶”ì²œ í¬ìŠ¤íŠ¸ ê²€ìƒ‰</div></div>
          </div>
      </div>
  </article>
  <article class="AI_recommend_box">
      <div class="AI_store_recommend_header">
          <div id="article_title">ë„ë´‰êµ¬ì—ì„œ ì ì‹¬ì„ ë“œì‹œë‚˜ìš”?</div>
              <div id="button_explore_store">
              <img class="explore_store_img" src="{% static 'img/explore_store.png'%}">
              <span>ë§›ì§‘ íƒí—˜</span>
      </div>
  </div>
  <div>
      <div class="AI_store_header">
          <img id="store_img" src="{% static 'img/likelion.png'%}">
          <div class="store_info">
              <span id="store_name">ë‹¤ëª¬ì´ˆë°¥</span>
              <span id="store_address">ì„œìš¸ ë„ë´‰êµ¬ ìš°ì´ì²œë¡œ 350</span>
          </div>
      </div>
      <hr id="explore_line">
<div id="store_review">
  ì €ë ´í•˜ê³  í‘¸ì§í•œ ......ë§ì•„ ë°°ë¶€ë¥´ë‹¤ëŠ” í›„ê¸°ê°€ ë§ì•„ìš”!
</div>

      </div>
  </article>
<article class="AI_recommend_box">
  <div id="article_title">ë„ë´‰êµ¬ì˜ ìˆ¨ê²¨ì§„ ì´ì•¼ê¸°</div>
  <div id="information_place"><b>ë•ì„±ì—¬ìëŒ€í•™êµ</b>ëŠ” ë„ë´‰êµ¬ì—ì„œ ìœ ì¼í•œ ëŒ€í•™ì´ë¼, ì‚¬ì‹¤ìƒ ì´ë™ë„¤ì˜ 'ëœë“œë§ˆí¬'ì•„ì• ìš”. êµë‚´ì—ì„œ ë¶í•œì‚°ì´ ë°”ë¡œ ë³´ì´ê³  ì‹¤ì œë¡œ 'ë“±ì‚°'ìˆ˜ì—…ë„ ê°œì„¤ë˜ì–´ ìˆë‹µë‹ˆë‹¤.</div>
  <div class="button_place"><span id="button_more">ë” ì•Œì•„ë³´ê¸°</span></div>
</article>

</div>


<!--

  {% if request.user.is_authenticated %}
  <div id="chat" style="margin-bottom:10px;"></div>

  <input id="msg" placeholder="ë©”ì‹œì§€ ì…ë ¥..." />
  <input id="img" type="file" accept="image/*" />
  <button id="sendBtn">ë³´ë‚´ê¸°</button>

-->
<script>
async function send(){
  const chat = document.getElementById("chat");
  const msgEl = document.getElementById("msg");
  const imgEl = document.getElementById("img");
  const msg = msgEl.value.trim();
  const file = imgEl && imgEl.files.length > 0 ? imgEl.files[0] : null;

  if (!msg && !file) {
    alert("ë©”ì‹œì§€ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!");
    return;
  }

  // ë³´ë‚¸ ë‚´ìš© í‘œì‹œ
  let me = `ğŸ‘¤: ${msg || "(ì´ë¯¸ì§€ë§Œ ì „ì†¡)"}`;
  if (file) me += ` <small>+ [ì´ë¯¸ì§€ ì²¨ë¶€]</small>`;
  chat.insertAdjacentHTML("beforeend", `<div>${me}</div>`);

  // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
  if (file) {
    const reader = new FileReader();
    reader.onload = () => {
      chat.insertAdjacentHTML("beforeend",
        `<img src="${reader.result}" style="max-width:220px;border:1px solid #ddd;margin:6px 0;"/>`
      );
    };
    reader.readAsDataURL(file);
  }

  // FormData ì „ì†¡
  const fd = new FormData();
  if (msg) fd.append("message", msg);
  if (file) fd.append("image", file);

  try {
    const res = await fetch("{% url 'explore:chat_api' %}", {
      method: "POST",
      body: fd
    });
    const data = await res.json();
    const bot = document.createElement("div");
      bot.className = "bot";
      bot.textContent = `ğŸ¤–: ${data.reply ?? ("ì—ëŸ¬: " + (data.error || res.status))}`;
      chat.appendChild(bot);
  } catch (e) {
    chat.insertAdjacentHTML("beforeend",
      `<div style="color:red">ìš”ì²­ ì‹¤íŒ¨: ${e}</div>`
    );
  } finally {
    msgEl.value = "";
    if (imgEl) imgEl.value = "";
  }
}

document.getElementById("sendBtn").addEventListener("click", send);
</script>
   <script src="{% static 'js/account/explore.js'%}"></script>
   <script src="{% static 'js/account/feed.js'%}"></script>
  {% else %}
  <a href="{% url 'account:login' %}?next={{ request.path|urlencode }}">ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”
  </a>
  {% endif %}

  
</body>
</html>
